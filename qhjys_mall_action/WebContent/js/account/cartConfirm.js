var changCartNum=function(d,i,c,k){var b=k.closest("td.td100");var h=b.find("input[name=unitp]").val();var g=b.next().find("label.total");var e=b.next().next().find("label.totalmon");var a=b.find("input[name=money]");var f=b.find("input[name=cartId]").val();var j=/^[0-9]*[1-9][0-9]*$/;if(!j.test(c)){return false}$.ajax({async:true,type:"POST",url:"/managermall/account/changCartNum.do",data:{createTime:f,prodId:d,storeId:i,prodNum:c},success:function(m){if(m==null||m==""){location.href="/account/login.do"}if(m){g.text(parseFloat(c*h));e.text((parseFloat(c*h)/20).toFixed(2));a.val(parseFloat(c*h));var l=0;$("#cartTable input[name=money]").each(function(){l+=parseFloat(this.value)});$("#ordTotal").text(l);k.val(c)}else{alert("修改商品数量异常，请重新登录！")}}})};$(function(){var a=0;$("#cartTable input[name=money]").each(function(){a+=parseFloat(this.value)});$("#ordTotal").html(a);$("input[name=add],input[name=sub]").on("click",function(h){var d=$(this).parent();var g=d.find("input[name=prodId]").val();var b=d.find("input[name=storeId]").val();var f=parseInt(d.find("input[name=unitPrice]").val());var i=parseInt(d.find("input[name=stock]").val());var c=parseInt(d.find("input[name=cartNum]").val());if(this.value=="+"){c++;if(c>f){alert("飞券数量不能大于商品价格!");return false}if(i&&1>i){alert("该商品库存不足!");return false}}else{c--;if(c<1){alert("商品数量必须大于0!");return false}}changCartNum(g,b,c,d.find("input[name=cartNum]"))});$("div.goumaishuliang input[name=cartNum]").on("change",function(){var c=$(this).parent();var e=c.find("input[name=prodId]").val();var d=parseInt(c.find("input[name=unitPrice]").val());var f=parseInt(c.find("input[name=stock]").val());var b=parseInt(c.find("input[name=cartNum]").val());if(b>d){alert("飞券数量不能大于商品价格!");return false}if(f&&1>f){alert("该商品库存不足!");return false}if(b<1){alert("商品数量必须大于0!");return false}changCartNum(e,b,c.find("input[name=cartNum]"))});$("li","#delivery").on("click",function(){$(this).siblings().removeClass("licurrent").find("input").removeAttr("checked");$(this).addClass("licurrent").find("input").prop("checked",true)});$("#coupon").on("click",function(){if($(this).prop("checked")){$("#useCoupon").css("display","inline")}else{$("#useCoupon").css("display","none")}});$("#couponId").on("change",function(){var c=$("#ordTotal").html();var b=parseInt($("#couponId>option:selected").prop("lang"))});$("#getCaptcha").on("click",function(){var d=/^0?1[3|4|5|7|8][0-9]\d{8}$/;var b=$("#phone").val();if(!d.test(b)){alert("手机号码格式错误！");return false}var c=$(this).attr("disabled",true);$.ajax({async:true,type:"POST",url:"/sendSMSCaptcha.do",data:{phone:b},success:function(e){if(e=="0000"){timeWait(c)}else{if(e=="0001"){alert("手机号码格式错误！")}else{alert("发送短信异常！")}c.removeAttr("disabled")}}})});$("#phone").blur(function(){$("#phone").next().remove();var c=$('<label class="one1" style="width:180px;color:red;">请输入手机号码</label>');var d=$("#phone").val().trim();var b=/^(?:13\d|15\d|17\d|18\d)\d{5}(\d{3}|\*{3})$/;if(d==""){$("#phone").after(c)}else{if(!b.test($("#phone").val())){str="请输入正确的手机号";c=$('<label class="one1" style="width:180px;color:red;">'+str+"</label>");$("#phone").after(c)}}});$("#captcha").blur(function(){$("#captcha").next().remove();if($("#captcha").val().trim()==""){var b=$('<label class="one1" style="width:180px;color:red;">请输入动态码</label>');$("#captcha").after(b)}});$("#cartForm").submit(function(){var e=$("input[name='address']:checked").val();var g=$("input[name='token']").val();var c=$("#phone").val();var d=$("#captcha").val();if($("#phoneNum").val()==""||$("#phoneNum").val()==null){$("#tishinr label[class=one1]").remove();var b=/^(?:13\d|15\d|17\d|18\d)\d{5}(\d{3}|\*{3})$/;if($("#phone").val().trim()==""){var f=$('<label class="one1" style="width:180px;color:red;">请输入手机号码</label>');$("#phone").after(f);alert("请填写手机号码")}else{if(!b.test($("#phone").val())){var i="请输入正确的手机号";var f=$('<label class="one1" style="width:180px;color:red;">'+i+"</label>");$("#phone").after(f)}}if($("#captcha").val().trim()==""){var f=$('<label class="one1" style="width:180px;color:red;">请输入动态码</label>');$("#captcha").after(f)}}if($("#tishinr label[class=one1]").length>0){return false}var h=null;if($("#coupon").prop("checked")){h=$("#couponId").val()}$.ajax({async:false,type:"POST",url:"/managermall/account/order/addOrder.do",data:{addrId:e,token:g,captcha:d,phone:c,couponId:h},success:function(j){if(j=="tokenError"){alert("表单重复提交")}else{if(j=="codeError"){alert("验证码错误")}else{if(!isNaN(j)){alert("提交订单成功");window.location.href="/managermall/account/order/toPay.do?orderId="+j}else{alert(j)}}}},error:function(j){alert("error");return false}});return false})});var wait=120;function timeWait(a){if(wait==0){a.removeAttr("disabled");a.val("获取验证码");wait=120}else{a.attr("disabled",true);a.val("重新发送("+wait+")");wait--;setTimeout(function(){timeWait(a)},1000)}}function del(c,a,b){$.ajax({async:true,type:"POST",url:"/managermall/account/delCartProd.do?prodId="+c+"&storeId="+a+"&createTime="+b,success:function(d){if(d){location.reload()}else{alert("服务器忙")}}})};