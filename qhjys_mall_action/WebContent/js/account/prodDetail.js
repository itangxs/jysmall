Date.prototype.format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in c){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(c[b]):(("00"+c[b]).substr((""+c[b]).length)))}}return a};var getProdReviews=function(b,c,a){$.ajax({async:true,type:"POST",url:"queryProdReviews.do",data:{prodId:b,level:c,pageNum:a,pageSize:10},success:function(j){var g=$("#reviews");g.html("");$(".page").remove();var h,e;$(j.page).each(function(){var m=$("<li></li>");var l=$('<div class="pingjianr_people"><img src="/images/login_img.jpg" /></div>');var o=$('<div class="pingjianr_nr"></div>');var k=$("<h1></h1>");var p=$('<div class="pingjiapic"></div>');h=new Date(this.revDate);if(this.userAvatar){l.find("img").attr("src",this.userAvatar)}k.append('<div class="wuxing"><span><em style="width:'+this.score*20+'%;"></em></span></div>');k.append(h.format("yyyy-MM-dd hh:mm:ss")+" "+this.nickname+"说：");o.append(k);o.append("<p>"+this.reviews+"</p>");if(this.reviewImg){e=this.reviewImg.split("|");for(var n=0;n<e.length;n++){if(e[n].length>1){p.append('<img src="'+e[n]+'"/>')}}o.append(p)}if(this.replyContent){o.append('<div class="pingjianr_reply"><p>[回复] '+new Date(this.replyTime).format("yyyy-MM-dd hh:mm:ss")+"</p><p>"+this.replyContent+"</p></div>")}m.append(l);m.append(o);m.append('<div class="clear"></div>');g.append(m)});var d='<div class="page"><span>共'+j.pages+"页</span>";if(j.num>1){d+='<a href="javascript:changepage(-1,'+j.num+');" class="prev">上一页</a>'}for(var f=1;f<=j.pages;f++){if(f==j.num){d+='<em class="current">'+f+"</em>"}else{if(j.pages<8||f<4||f>j.pages-4){d+='<a href="javascript:;changepage(-3,'+f+')">'+f+"</a>"}else{d+="<em>...</em>"}}}if(j.num<j.pages){d+='<a href="javascript:changepage(1,'+j.num+');" class="next">下一页</a>'}d+="<span>到第</span>";d+='<input type="text" name="jumpPage" id="jumPage" class="input1" onChange="changepage(0,'+j.num+')"><span>页</span></div>';g.parent().append(d)}})};function changepage(e,b){var c=$("#prodId"),d=$("input[name='level']:checked");var a=b;if(e==1){a=b+1}else{if(e==-1){a=b-1}else{if(e==0){a=$("#jumPage").val()}}}getProdReviews(c.val(),d.val(),a)}$(function(){var b=$("#prodId"),e=$("input[name='level']:checked");getProdReviews(b.val(),e.val(),1);var d=parseInt($("#maxPay").val());var a=parseInt($("#maxPrice").val());var c=parseInt($("#stock").val());$("#add").on("click",function(){var f=parseInt($("#prodNum").val())+1;if(f>a){alert("购买数量不能超过商品价格");return false}$("#prodNum").val(f)});$("#subtract").on("click",function(){var f=parseInt($("#prodNum").val())-1;if(f<1){alert("数量不能少于1");return false}$("#prodNum").val(f)});$("#prodNum").on("change",function(){var f=parseInt($("#prodNum").val());if(f>a){alert("购买数量不能超过商品价格");$("#prodNum").val(a)}if(f<1){alert("数量不能少于1");return false}});$("a[name=qiang],a[name=jiaru]").on("click",function(){var i=(this.name=="qiang"?1:0);var g=$("#prodId").val();var h=$("#prodNum").val();var f=/^[1-9]*[1-9][0-9]*$/;if(!f.test(h)){alert("商品数量错误！");return false}if(c<1){alert("商品数量不足!");return false}addCartProd(g,h,i)});$("#shopMsg>div.close,#close").on("click",function(){$("#shopMsg").css("display","none")});$(".linkcurrent").click(function(){var f=$("#prodId"),g=$("input[name='level']:checked");getProdReviews(f.val(),g.val(),1)});$("a[name=goTop]").on("click",function(){$("html, body").animate({scrollTop:0},600)});$("#rtanchu1").mouseover(function(){$("#tanchu1").show()});$("#rtanchu1").mouseout(function(){$("#tanchu1").hide()});$("#rtanchu4").hover(function(){$("#tanchu4").show()},function(){$("#tanchu4").hide()})});var addCartProd=function(a,b,c){$.ajax({async:true,type:"POST",url:"/managermall/account/addCartProd.do",data:{prodId:a,prodNum:b},success:function(d){if(d=="success"){if(c==1){location.href="/managermall/account/toCartConfirm.do"}else{$("#shopMsg").css("display","block")}}else{if(d=="userNull"){alert("请先登录！");if(c==1){location.href="/account/login.do"}}else{if(d=="prodNull"){alert("商品参数错误！")}else{if(d=="prodError"){alert("该商品已下架！")}else{alert("加入购物车出错，请重试！")}}}}}})};function shoucang(c,b){if(1==b){var a="/managermall/account/order/addMyProdCollet.do?proId="+c;$.ajax({async:true,type:"post",url:a,success:function(d){if(d=="addError"){}else{if(d=="userNull"){alert("请先登录");window.location.href="/account/login.do"}else{if(d=="error"){}else{if(d=="sccuess"){window.location.href=window.location.href}else{alert("请先登录");window.location.href="/account/login.do"}}}}},error:function(){alert("服务器忙")}})}if(2==b){var a="/managermall/account/order/deleteCollet.do?prodId="+c;$.ajax({type:"post",url:a,success:function(d){if(d=="addError"){}if(d=="userNull"){alert("请先登录");window.location.href="/account/login.do"}if(d=="error"){}if(d=="scuess"){window.location.href=window.location.href}},error:function(){}})}}function diag1(a){var c=prompt("请输入出发地:比如","前海金钥匙电子商务有限公司");if(c!==""&&c!="前海金钥匙电子商务有限公司"&&null!=c){var b="http://api.map.baidu.com/direction?origin="+c+"|name:"+c+"&destination="+a+"&mode=driving&region=深圳&output=html&src=yourCompanyName|yourAppName";window.open(b)}};